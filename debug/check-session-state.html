<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session State Debug Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #005a87;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Session State Debug Tool</h1>
        
        <div class="warning">
            <strong>Debug Mode:</strong> This tool helps diagnose why the NavUser component is not showing.
        </div>

        <div class="section">
            <h3>Check Session State</h3>
            <p>Click to check the current authentication session state:</p>
            <button class="button" onclick="checkSessionState()">Check Session</button>
            <button class="button" onclick="checkLocalStorage()">Check Local Storage</button>
            <button class="button" onclick="checkCookies()">Check Cookies</button>
            <div id="sessionOutput" class="output"></div>
        </div>

        <div class="section">
            <h3>Test Authentication API</h3>
            <p>Test direct API calls to the authentication endpoint:</p>
            <button class="button" onclick="testAuthAPI()">Test /api/auth/session</button>
            <div id="apiOutput" class="output"></div>
        </div>

        <div class="section">
            <h3>Console Logs</h3>
            <p>Check browser console for Layout component logs. Look for:</p>
            <ul>
                <li>"Layout session data:" - Shows the session object</li>
                <li>"Session user:" - Shows the user object</li>
                <li>"Layout userData:" - Shows the processed user data</li>
            </ul>
            <button class="button" onclick="window.location.href='http://localhost:5173/'">Go to Main App</button>
        </div>

        <div class="section">
            <h3>Manual Login Test</h3>
            <p>If no session is found, try logging in:</p>
            <button class="button" onclick="window.location.href='http://localhost:5173/login'">Go to Login</button>
        </div>
    </div>

    <script>
        function checkSessionState() {
            const output = document.getElementById('sessionOutput');
            output.textContent = 'Checking session state...\n';
            
            // Check if there's any session data in the browser
            const sessionData = {
                localStorage: Object.keys(localStorage).filter(key => 
                    key.includes('auth') || key.includes('session') || key.includes('user')
                ).reduce((obj, key) => {
                    obj[key] = localStorage.getItem(key);
                    return obj;
                }, {}),
                
                sessionStorage: Object.keys(sessionStorage).filter(key => 
                    key.includes('auth') || key.includes('session') || key.includes('user')
                ).reduce((obj, key) => {
                    obj[key] = sessionStorage.getItem(key);
                    return obj;
                }, {}),
                
                cookies: document.cookie.split(';').filter(cookie => 
                    cookie.includes('auth') || cookie.includes('session') || cookie.includes('user')
                ),
                
                currentURL: window.location.href,
                timestamp: new Date().toISOString()
            };
            
            output.textContent = JSON.stringify(sessionData, null, 2);
        }
        
        function checkLocalStorage() {
            const output = document.getElementById('sessionOutput');
            const allLocalStorage = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                allLocalStorage[key] = localStorage.getItem(key);
            }
            output.textContent = 'Local Storage:\n' + JSON.stringify(allLocalStorage, null, 2);
        }
        
        function checkCookies() {
            const output = document.getElementById('sessionOutput');
            output.textContent = 'Cookies:\n' + document.cookie;
        }
        
        async function testAuthAPI() {
            const output = document.getElementById('apiOutput');
            output.textContent = 'Testing authentication API...\n';
            
            try {
                const response = await fetch('http://localhost:8787/api/auth/session', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                output.textContent = `Status: ${response.status}\n` + 
                                   `Response: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>